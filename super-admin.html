<!doctype html>
<html lang="km">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Super Admin — PHD Report System</title>

  <!-- Khmer fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Khmer:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">

  <style>
    :root{
      --sidebar:#f1f5f9; --sidebar-txt:#0f172a; --primary:#4f46e5; --muted:#6b7280;
      --card:#fff; --ring:#a78bfa;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Noto Sans Khmer",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      color:#0f172a; background:#f7f8fc;
      display:grid; grid-template-columns:260px 1fr; grid-template-rows:auto 1fr;
      grid-template-areas:"aside header" "aside main";
    }
    /* ===== Sidebar ===== */
    aside{
      grid-area:aside; background:var(--sidebar); border-right:1px solid #e5e7eb;
      padding:14px 12px; position:sticky; top:0; height:100vh; overflow:auto;
    }
    .brand{display:flex; align-items:center; gap:10px; padding:8px 6px 16px}
    .brand .dot{width:36px;height:36px;border-radius:10px;background:#111;color:#fff;display:grid;place-items:center;font-weight:700}
    .brand .name{font-weight:700}
    .search{position:relative;margin:6px 6px 12px}
    .search input{width:100%;padding:10px 12px 10px 36px;border:1px solid #e5e7eb;border-radius:10px;background:#fff}
    .search i{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:#94a3b8}
    nav{display:flex;flex-direction:column;gap:6px;margin-top:6px}
    .item{
      display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;color:var(--sidebar-txt);
      text-decoration:none; font-weight:600;
    }
    .item i{color:#475569}
    .item:hover{background:#e9eef6}
    .item.active{background:#e0e7ff;color:#111;border:1px solid #c7d2fe}
    .section{margin:10px 8px 6px;color:var(--muted);font-size:12px;font-weight:700;text-transform:uppercase}
    /* ===== Header ===== */
    header{
      grid-area:header; background:#fff; border-bottom:1px solid #e5e7eb; display:flex; align-items:center;
      justify-content:space-between; padding:10px 16px;
    }
    .user{display:flex;align-items:center;gap:10px}
    .user .avatar{width:34px;height:34px;border-radius:50%;background:#111;color:#fff;display:grid;place-items:center;font-weight:700}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;cursor:pointer}
    .btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    /* ===== Main ===== */
    main{grid-area:main; padding:16px}
    .cards{display:grid;grid-template-columns:repeat(4, minmax(0,1fr));gap:12px}
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;padding:14px;box-shadow:0 6px 18px rgba(15,23,42,.05)}
    .card h3{margin:4px 0 6px}
    .muted{color:var(--muted)}
    @media (max-width:1100px){ .cards{grid-template-columns:repeat(2,1fr);} }
    @media (max-width:680px){
      body{grid-template-columns:1fr;grid-template-rows:auto auto 1fr;grid-template-areas:"header" "aside" "main";}
      aside{position:relative;height:auto}
    }
  </style>
</head>
<body>

  <!-- ========== Sidebar ========== -->
  <aside>
    <div class="brand">
      <div class="dot">P</div>
      <div>
        <div class="name">@ Your Company</div>
        <div class="muted" style="font-size:12px">Super Admin</div>
      </div>
    </div>

    <div class="search">
      <i class="ri-search-line"></i>
      <input type="text" placeholder="Search" oninput="filterMenu(this.value)">
    </div>

    <nav id="menu">
      <div class="section">ជំពូក</div>
      <a class="item active" href="#dashboard" data-route="dashboard"><i class="ri-home-5-line"></i> Dashboard</a>
      <a class="item" href="#reports" data-route="reports"><i class="ri-flag-2-line"></i> Reports</a>

      <div class="section">គ្រប់គ្រងទិន្នន័យ</div>
      <a class="item" href="#users" data-route="users"><i class="ri-user-settings-line"></i> ការគ្រប់គ្រងអ្នកប្រើប្រាស់</a>
      <a class="item" href="#departments" data-route="departments"><i class="ri-building-2-line"></i> ការគ្រប់គ្រងផ្នែក (Departments)</a>
      <a class="item" href="#units" data-route="units"><i class="ri-building-4-line"></i> ការគ្រប់គ្រងអង្គភាព (Units)</a>
      <a class="item" href="#periods" data-route="periods"><i class="ri-timer-line"></i> ការគ្រប់គ្រងរយៈពេល (Periods)</a>
      <a class="item" href="#indicators" data-route="indicators"><i class="ri-bar-chart-2-line"></i> ការគ្រប់គ្រងសូចនាករ (Indicators)</a>

      <div class="section">ផ្សេងៗ</div>
      <a class="item" href="#profile" data-route="profile"><i class="ri-user-3-line"></i> ប្រូហ្វាយអ្នកប្រើប្រាស់</a>
      <a class="item" href="#settings" data-route="settings"><i class="ri-settings-3-line"></i> Settings</a>
    </nav>
  </aside>

  <!-- ========== Header ========== -->
  <header>
    <div style="font-weight:700">ផ្ទាំងគ្រប់គ្រង (Super Admin)</div>
    <div class="user">
      <div id="who" class="muted"></div>
      <div class="avatar" id="avatar">SU</div>
      <button class="btn" onclick="goIndex()">ទៅ Dashboard ទូទៅ</button>
      <button class="btn primary" onclick="logout()">ចាកចេញ</button>
    </div>
  </header>

  <!-- ========== Main ========== -->
  <main>
    <div class="cards">
      <div class="card"><div class="muted">ចំនួនអ្នកប្រើ</div><h3 id="statUsers">—</h3></div>
      <div class="card"><div class="muted">សូចនាករ</div><h3 id="statInd">—</h3></div>
      <div class="card"><div class="muted">រយៈពេល</div><h3 id="statPeriods">—</h3></div>
      <div class="card"><div class="muted">ផ្នែក</div><h3 id="statDept">—</h3></div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>សង្ខេប</h3>
      <p class="muted">ទំព័រនេះគ្រាន់តែជាគ្រោងសម្រាប់ Super Admin. ចុចម៉ឺនុយខាងឆ្វេងដើម្បីទៅគ្រប់គ្រងតារាង (Users, Departments, Units, Periods, Indicators)។</p>
      <p class="muted">អ្នកអាចភ្ជាប់ទៅទំព័រផ្សេងៗ (users.html, departments.html ...) ឬបង្ហាញ modal CRUD នៅទីនេះតាមដែលចង់។</p>
    </div>
  </main>

  <script>
    // ===== Guard: only superadmin can view =====
    const AUTH = (()=>{
      try{ return JSON.parse(localStorage.getItem("AUTH")||"null"); }catch{ return null; }
    })();

    function isSuper(p){
      return p && (String(p.user_type||"").toLowerCase()==="superuser" ||
                   String(p.user_root||"").toLowerCase()==="all");
    }

    if(!AUTH){ location.href = "login.html"; }
    else if(!isSuper(AUTH)){ location.href = "index.html"; }

    // Header info
    (function setWho(){
      const w = document.getElementById("who");
      w.textContent = AUTH ? `${AUTH.user_name} • ${AUTH.user_type||''}` : '';
      const av = document.getElementById("avatar");
      av.textContent = (AUTH?.user_name || 'SU').slice(0,2).toUpperCase();
    })();

    function logout(){
      localStorage.removeItem("AUTH");
      location.href = "login.html";
    }
    function goIndex(){ location.href = "index.html"; }

    // ===== Simple menu filtering & active state =====
    function filterMenu(q){
      q = (q||'').toLowerCase();
      document.querySelectorAll('#menu .item').forEach(a=>{
        const show = a.textContent.toLowerCase().includes(q);
        a.style.display = show ? '' : 'none';
      });
    }
    document.querySelectorAll('#menu .item').forEach(a=>{
      a.addEventListener('click', e=>{
        document.querySelectorAll('#menu .item').forEach(x=>x.classList.remove('active'));
        a.classList.add('active');
      });
    });

    // ===== Example stats from Apps Script (optional) =====
    const API_BASE = localStorage.getItem("API_BASE") || "";
    async function fetchCount(route){
      if(!API_BASE) return "—";
      const url = API_BASE + (API_BASE.includes("?") ? "&" : "?") + `api=1&route=${route}&op=list&limit=1`;
      try{
        const res = await fetch(url, {cache:"no-store"});
        if(!res.ok) return "—";
        const j = await res.json();
        return j?.total ?? "—";
      }catch{ return "—"; }
    }
    (async function loadStats(){
      document.getElementById('statUsers').textContent   = await fetchCount('users');
      document.getElementById('statInd').textContent     = await fetchCount('indicators');
      document.getElementById('statPeriods').textContent = await fetchCount('periods');
      document.getElementById('statDept').textContent    = await fetchCount('departments');
    })();
  </script>
</body>
</html>
