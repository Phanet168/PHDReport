<!doctype html>
<html lang="km">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Super Admin — PHD Report</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Khmer:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <style>
    :root{--rail:260px;--rail-c:72px;--primary:#6d5df6;--ink:#0f172a;--muted:#64748b;--line:#e9eef5}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:"Noto Sans Khmer",system-ui;display:grid;grid-template-columns:var(--rail) 1fr;grid-template-rows:auto 1fr;grid-template-areas:"aside header" "aside main";background:#f7f8fc;color:var(--ink);transition:.25s}
    body.c{grid-template-columns:var(--rail-c) 1fr}
    aside{grid-area:aside;background:#111827;color:#e5e7eb;border-right:1px solid #0b1220;position:sticky;top:0;height:100vh;overflow:auto;padding:14px 10px}
    .brand{display:flex;gap:10px;align-items:center;padding:6px 8px 14px}
    .logo{width:36px;height:36px;border-radius:10px;background:#fff;color:#111;display:grid;place-items:center;font-weight:800}
    .label{transition:.2s} body.c .label{opacity:0;transform:translateX(-6px);pointer-events:none}
    .search{position:relative;margin:6px} .search input{width:100%;padding:10px 12px 10px 36px;border-radius:10px;background:#0f172a;border:1px solid #1f2937;color:#e5e7eb}
    body.c .search{display:none} .search i{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:#94a3b8}
    nav{display:flex;flex-direction:column;gap:4px;margin-top:6px}
    .item{display:flex;gap:12px;align-items:center;padding:10px 12px;border-radius:10px;color:#e5e7eb;text-decoration:none}
    .item:hover{background:#1f2937} .item.active{background:#312e81}
    header{grid-area:header;background:#fff;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center;padding:10px 16px}
    .btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 10px;cursor:pointer}
    .btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    .user{display:flex;gap:10px;align-items:center}.avatar{width:34px;height:34px;border-radius:50%;background:#111;color:#fff;display:grid;place-items:center;font-weight:700}
    main{grid-area:main;padding:16px}
    .cards{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 8px 24px rgba(15,23,42,.05)}
    .muted{color:var(--muted)}
    .grid{display:grid;gap:12px}.two{grid-template-columns:2fr 1fr}
    @media(max-width:1100px){.cards{grid-template-columns:repeat(2,1fr)}.two{grid-template-columns:1fr}}
    /* loader */
    .loader{position:fixed;inset:0;background:rgba(255,255,255,.6);display:none;align-items:center;justify-content:center;z-index:40;backdrop-filter:blur(2px)}
    .loader.show{display:flex}.spin{width:46px;height:46px;border:4px solid #ddd;border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div id="loader" class="loader"><div class="spin"></div></div>

  <aside>
    <div class="brand"><div class="logo">P</div><div class="label">@ Your Company</div></div>
    <div class="search"><i class="ri-search-line"></i><input type="text" placeholder="ស្វែងរក" oninput="filterMenu(this.value)"></div>
    <nav id="menu">
      <a class="item active" href="#dashboard"><i class="ri-home-5-line"></i><span class="label">Dashboard</span></a>
      <a class="item" href="#reports"><i class="ri-flag-2-line"></i><span class="label">Reports</span></a>
      <a class="item" href="#users"><i class="ri-user-settings-line"></i><span class="label">អ្នកប្រើប្រាស់</span></a>
      <a class="item" href="#departments"><i class="ri-building-2-line"></i><span class="label">Departments</span></a>
      <a class="item" href="#units"><i class="ri-building-4-line"></i><span class="label">Units</span></a>
      <a class="item" href="#periods"><i class="ri-timer-line"></i><span class="label">Periods</span></a>
      <a class="item" href="#indicators"><i class="ri-bar-chart-2-line"></i><span class="label">Indicators</span></a>
      <a class="item" href="#settings"><i class="ri-settings-3-line"></i><span class="label">Settings</span></a>
    </nav>
  </aside>

  <header>
    <div style="display:flex;gap:8px;align-items:center">
      <button class="btn" id="toggle"><i class="ri-menu-line"></i></button>
      <div style="font-weight:700">Version 1</div>
      <div class="muted">Dashboard / Version 1</div>
    </div>
    <div class="user">
      <div id="who" class="muted"></div>
      <div id="av" class="avatar">SU</div>
      <button class="btn" onclick="location.href='index.html'">Dashboard ទូទៅ</button>
      <button class="btn primary" onclick="Auth.clear();location.href='login.html'">ចាកចេញ</button>
    </div>
  </header>

  <main>
    <div class="cards">
      <div class="card"><div class="muted">New Leads</div><h2 id="k1">205</h2></div>
      <div class="card"><div class="muted">Sales</div><h2>$4021</h2></div>
      <div class="card"><div class="muted">Orders</div><h2>80</h2></div>
      <div class="card"><div class="muted">Expense</div><h2>$1200</h2></div>
    </div>

    <div class="grid two" style="margin-top:12px">
      <div class="card"><div style="font-weight:700;margin-bottom:8px">This Year Sales</div><div id="bar" style="height:340px"></div></div>
      <div class="card"><div style="font-weight:700;margin-bottom:8px">Sales by Countries</div><div id="pie" style="height:340px"></div></div>
    </div>

    <div class="card" style="margin-top:12px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="muted">ចំនួនអ្នកប្រើសរុប: <span id="totalUsers">—</span></div>
        <button class="btn primary" onclick="demoSave()">+ បន្ថែមអ្នកប្រើ</button>
      </div>
    </div>
  </main>

  <script src="auth.js"></script>
  <script>
    // Guard
    Auth.requireSuper();

    // Header info
    const A = Auth.get();
    document.getElementById('who').textContent = `${A.user_name} • ${A.user_type||''}`;
    document.getElementById('av').textContent = (A.user_name||'SU').slice(0,2).toUpperCase();

    // Sidebar toggle
    document.getElementById('toggle').onclick = ()=> document.body.classList.toggle('c');

    // Menu
    function filterMenu(q){
      q=(q||'').toLowerCase();
      document.querySelectorAll('#menu .item').forEach(a=>{
        a.style.display = a.textContent.toLowerCase().includes(q) ? '' : 'none';
      });
    }

    // Loader
    const L = document.getElementById('loader');
    const show = ()=>L.classList.add('show'), hide = ()=>L.classList.remove('show');
    function demoSave(){ show(); setTimeout(()=>{ hide(); alert('រក្សាទុកបាន (demo)'); }, 800); }

    // API counts
    (async function(){
      show();
      document.getElementById('totalUsers').textContent = await apiCount('users');
      hide();
    })();

    // Charts
    (function charts(){
      const bar = echarts.init(document.getElementById('bar'));
      bar.setOption({
        legend:{data:['Online','Offline']}, grid:{left:30,right:10,top:30,bottom:30},
        xAxis:{type:'category',data:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sept','Oct','Nov','Dec']},
        yAxis:{type:'value'},
        series:[
          {name:'Online', type:'bar', data:[45,78,22,60,50,48,30,65,70,58,20,32]},
          {name:'Offline', type:'bar', data:[58,62,35,95,72,90,48,82,79,88,35,40]}
        ]
      });
      const pie = echarts.init(document.getElementById('pie'));
      pie.setOption({ series:[{type:'pie',radius:['40%','70%'],data:[
        {value:35,name:'USA'},{value:22,name:'India'},{value:10,name:'UK'},{value:14,name:'France'},{value:19,name:'Brazil'}
      ]}]});
      addEventListener('resize', ()=>{ bar.resize(); pie.resize(); });
    })();
  </script>
</body>
</html>
