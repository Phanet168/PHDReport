<!doctype html>
<html lang="km">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Super Admin — PHD Report</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Khmer:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <style>
    :root{--rail:260px;--rail-c:72px;--primary:#6d5df6;--ink:#0f172a;--muted:#64748b;--line:#e9eef5}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:"Noto Sans Khmer",system-ui;display:grid;grid-template-columns:var(--rail) 1fr;grid-template-rows:auto 1fr;grid-template-areas:"aside header" "aside main";background:#f7f8fc;color:var(--ink);transition:.25s}
    body.c{grid-template-columns:var(--rail-c) 1fr}
    aside{grid-area:aside;background:#111827;color:#e5e7eb;border-right:1px solid #0b1220;position:sticky;top:0;height:100vh;overflow:auto;padding:14px 10px}
    .brand{display:flex;gap:10px;align-items:center;padding:6px 8px 14px}
    .logo{width:36px;height:36px;border-radius:10px;background:#fff;color:#111;display:grid;place-items:center;font-weight:800}
    .label{transition:.2s} body.c .label{opacity:0;transform:translateX(-6px);pointer-events:none}
    .search{position:relative;margin:6px} .search input{width:100%;padding:10px 12px 10px 36px;border-radius:10px;background:#0f172a;border:1px solid #1f2937;color:#e5e7eb}
    body.c .search{display:none} .search i{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:#94a3b8}
    nav{display:flex;flex-direction:column;gap:4px;margin-top:6px}
    .item{display:flex;gap:12px;align-items:center;padding:10px 12px;border-radius:10px;color:#e5e7eb;text-decoration:none}
    .item:hover{background:#1f2937} .item.active{background:#312e81}
    header{grid-area:header;background:#fff;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center;padding:10px 16px}
    .btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 10px;cursor:pointer}
    .btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    .btn.danger{background:#ef4444;border-color:#ef4444;color:#fff}
    .user{display:flex;gap:10px;align-items:center}.avatar{width:34px;height:34px;border-radius:50%;background:#111;color:#fff;display:grid;place-items:center;font-weight:700}
    main{grid-area:main;padding:16px}
    .cards{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 8px 24px rgba(15,23,42,.05)}
    .muted{color:var(--muted)}
    .grid{display:grid;gap:12px}.two{grid-template-columns:2fr 1fr}
    @media(max-width:1100px){.cards{grid-template-columns:repeat(2,1fr)}.two{grid-template-columns:1fr}}
    /* table */
    .toolbar{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:8px}
    .ipt{padding:10px 12px;border:1px solid var(--line);border-radius:10px;width:280px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid var(--line);padding:10px;text-align:left}
    th{font-weight:700;background:#fafafa}
    tr:hover td{background:#fcfcff}
    /* modal */
    dialog{border:none;border-radius:14px;width:min(520px,94vw);padding:0;box-shadow:0 20px 60px rgba(2,6,23,.25)}
    .m-head{padding:14px 16px;border-bottom:1px solid var(--line);font-weight:700}
    .m-body{padding:14px 16px;display:grid;gap:10px}
    .m-row{display:grid;gap:6px}
    .m-actions{display:flex;gap:8px;justify-content:flex-end;padding:12px 16px;border-top:1px solid var(--line)}
    .m-ipt{padding:10px;border:1px solid var(--line);border-radius:10px;width:100%}
    /* loader */
    .loader{position:fixed;inset:0;background:rgba(255,255,255,.6);display:none;align-items:center;justify-content:center;z-index:40;backdrop-filter:blur(2px)}
    .loader.show{display:flex}.spin{width:46px;height:46px;border:4px solid #ddd;border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    /* toast */
    .toast{position:fixed;right:14px;bottom:14px;background:#111827;color:#fff;padding:12px 14px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.25);display:none;z-index:50}
 /* collapsible groups */
.group{margin-top:4px}
.group>summary{list-style:none;cursor:pointer}
.group>summary::-webkit-details-marker{display:none}
.group[open] .caret{transform:rotate(180deg)}
.caret{margin-left:auto;transition:.2s}
.sub-wrap{display:grid;gap:6px;padding:4px 0 8px 46px}
.sub{color:#e5e7eb;text-decoration:none;padding:6px 0;border-radius:8px}
.sub:hover{color:#fff;text-decoration:underline}

  
  </style>
</head>
<body>
  <div id="loader" class="loader"><div class="spin"></div></div>
  <div id="toast" class="toast"></div>

  <aside>
    <div class="brand"><div class="logo">P</div><div class="label">@ Your Company</div></div>
    <div class="search"><i class="ri-search-line"></i><input type="text" placeholder="ស្វែងរកមឺនុយ" oninput="filterMenu(this.value)"></div>
   <nav id="menu">
  <!-- ផ្ទាំងគ្រប់គ្រង -->
  <a class="item active" data-route="dashboard" href="#">
    <i class="ri-home-5-line"></i><span class="label">ផ្ទាំងគ្រប់គ្រង</span>
  </a>

  <!-- រដ្ឋបាល -->
  <a class="item" data-route="indicators" data-filter='{"department_id":1}' href="#">
    <i class="ri-building-2-line"></i><span class="label">រដ្ឋបាល</span>
  </a>

  <!-- គណនេយ្យ -->
  <a class="item" data-route="indicators" data-filter='{"department_id":3}' href="#">
    <i class="ri-bank-card-line"></i><span class="label">គណនេយ្យ</span>
  </a>

  <!-- បង្ការនិងគ្រប់គ្រងជំងឺ (មានប្លុករង) -->
  <details class="group" open>
    <summary class="item">
      <i class="ri-hospital-line"></i><span class="label">បង្ការនិងគ្រប់គ្រងជំងឺ</span>
      <i class="ri-arrow-down-s-line caret"></i>
    </summary>
    <div class="sub-wrap">
      <!-- បើក CRUD ទៅ Units ហើយ filter ទៅ department_id=2 + ដាក់ q ស្វែងរក -->
      <a class="sub" data-route="units" data-filter='{"department_id":2}' data-q="MCH" href="#">• កម្មវិធី MCH</a>
      <a class="sub" data-route="units" data-filter='{"department_id":2}' data-q="ឆ្លង" href="#">• កម្មវិធីគ្រប់គ្រងជំងឺឆ្លង</a>
      <a class="sub" data-route="units" data-filter='{"department_id":2}' data-q="មិនឆ្លង" href="#">• កម្មវិធីគ្រប់គ្រងជំងឺមិនឆ្លង</a>
      <!-- ប្រសិនបើចង់មើលសូចនាកររបស់នាយកដ្ឋាននេះទាំងមូល -->
      <a class="sub" data-route="indicators" data-filter='{"department_id":2}' href="#">• សូចនាករនាយកដ្ឋាន</a>
    </div>
  </details>

  <!-- និយ័តកម្មសុខាភិបាល -->
  <a class="item" data-route="indicators" data-filter='{"department_id":4}' href="#">
    <i class="ri-verified-badge-line"></i><span class="label">និយ័តកម្មសុខាភិបាល</span>
  </a>

  <!-- របាយការណ៍ -->
  <a class="item" data-route="reports" href="#">
    <i class="ri-bar-chart-2-line"></i><span class="label">របាយការណ៍</span>
  </a>

  <!-- គ្រប់គ្រងអ្នកប្រើប្រាស់ -->
  <a class="item" data-route="users" href="#">
    <i class="ri-user-settings-line"></i><span class="label">គ្រប់គ្រងអ្នកប្រើប្រាស់</span>
  </a>

  <!-- គ្រប់គ្រងប្រព័ន្ធ (Periods/Indicators) -->
  <details class="group">
    <summary class="item">
      <i class="ri-settings-3-line"></i><span class="label">គ្រប់គ្រងប្រព័ន្ធ</span>
      <i class="ri-arrow-down-s-line caret"></i>
    </summary>
    <div class="sub-wrap">
      <a class="sub" data-route="periods" href="#">• Periods</a>
      <a class="sub" data-route="indicators" href="#">• Indicators</a>
    </div>
  </details>
</nav>

  </aside>

  <header>
    <div style="display:flex;gap:8px;align-items:center">
      <button class="btn" id="toggle"><i class="ri-menu-line"></i></button>
      <div style="font-weight:700">Super Admin</div>
      <div class="muted">គ្រប់គ្រងទិន្នន័យ</div>
    </div>
    <div class="user">
      <div id="who" class="muted"></div>
      <div id="av" class="avatar">SU</div>
      <button class="btn" onclick="location.href='index.html'">Dashboard ទូទៅ</button>
      <button class="btn primary" onclick="Auth.clear();location.href='login.html'">ចាកចេញ</button>
    </div>
  </header>

  <main>
    <!-- Top metrics + charts -->
    <section id="dashboard-sec">
      <div class="cards">
        <div class="card"><div class="muted">អ្នកប្រើសរុប</div><h2 id="m_users">—</h2></div>
        <div class="card"><div class="muted">Departments</div><h2 id="m_deps">—</h2></div>
        <div class="card"><div class="muted">Units</div><h2 id="m_units">—</h2></div>
        <div class="card"><div class="muted">Indicators</div><h2 id="m_inds">—</h2></div>
      </div>
      <div class="grid two" style="margin-top:12px">
        <div class="card"><div style="font-weight:700;margin-bottom:8px">This Year Sales</div><div id="bar" style="height:340px"></div></div>
        <div class="card"><div style="font-weight:700;margin-bottom:8px">Sales by Countries</div><div id="pie" style="height:340px"></div></div>
      </div>
    </section>

    <!-- Generic CRUD section -->
    <section id="crud-sec" style="display:none">
      <div class="card">
        <div class="toolbar">
          <div style="display:flex;gap:8px;align-items:center">
            <div id="crud-title" style="font-weight:700;font-size:18px">Table</div>
            <span class="muted"> • សរុប <span id="crud-total">0</span></span>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="crud-q" class="ipt" placeholder="ស្វែងរក...">
            <button id="btn-add" class="btn primary"><i class="ri-add-line"></i> បន្ថែម</button>
          </div>
        </div>
        <div class="table-wrap">
          <table>
            <thead id="thead"></thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal -->
  <dialog id="dlg">
    <form id="dlg-form" method="dialog">
      <div class="m-head" id="dlg-title">បញ្ចូលទិន្នន័យ</div>
      <div class="m-body" id="dlg-body"></div>
      <div class="m-actions">
        <button type="button" class="btn" onclick="Dlg.close()">បោះបង់</button>
        <button type="submit" class="btn primary">រក្សាទុក</button>
      </div>
    </form>
  </dialog>

  <script src="auth.js"></script>
  <script src="admin.js"></script>
</body>
</html>
