<!-- sitting/indicators/index.html -->
<div class="settings-page">
  <div class="container-page">
    <div class="page-head">
      <div class="d-flex align-items-center gap-2">
        <h1 class="kh-head h4 m-0">សូចនាករ</h1>
        <nav aria-label="breadcrumb" class="small">
          <ol class="breadcrumb m-0">
            <li class="breadcrumb-item"><a href="#/">Dashboard</a></li>
            <li class="breadcrumb-item">Settings</li>
            <li class="breadcrumb-item active" aria-current="page">Indicators</li>
          </ol>
        </nav>
      </div>
      <div class="separator-breadcrumb border-top"></div>
    </div>

    <div class="page-body">
      <div class="card shadow-sm centered-card w-100">
        <div class="card-body">
          <div class="toolbar mb-3">
            <h4 class="card-title kh-head m-0">បញ្ជីសូចនាករ</h4>
            <div class="actions ms-auto">
              <div class="input-group input-group-sm">
                <input id="txtSearch" class="form-control" placeholder="ស្វែងរក...">
                <button id="btnAdd" class="btn btn-primary">
                  <i class="i-Add"></i> បន្ថែម
                </button>
              </div>
            </div>
          </div>

          <div class="table-responsive">
            <table id="tblIndicators" class="table table-striped table-hover align-middle mb-0">
              <thead>
              <tr>
                <!-- ✅ data-sort keys -->
                <th data-sort="indicator_id"    style="width:80px">ID</th>
                <th data-sort="indicator_name">ឈ្មោះសូចនាករ</th>
                <th data-sort="indicator_type"  style="width:160px">ប្រភេទ</th>
                <th data-sort="department_name" style="width:160px">ជំពូក</th>
                <th data-sort="unit_name"       style="width:160px">ផ្នែក</th>
                <th data-sort="owner"           style="width:60px">ម្ចាស់ (Owner)</th>
                <th style="width:160px" class="text-end">សកម្មភាព</th>
              </tr>
              </thead>
              <tbody>
              <tr><td colspan="7" class="skel"></td></tr>
              <tr><td colspan="7" class="skel"></td></tr>
              <tr><td colspan="7" class="skel"></td></tr>
              <tr><td colspan="7" class="skel"></td></tr>
              </tbody>
            </table>
          </div>

          <!-- ✅ Page size + Pager -->
          <div class="d-flex align-items-center gap-2 mt-2">
            <select id="indicatorsPageSize" class="form-select form-select-sm" style="width:auto">
              <option value="10">10</option>
              <option value="20">20</option>
              <option value="50">50</option>
            </select>
            <div id="indicatorsPager" class="ms-auto"></div>
          </div>

          <div class="small text-muted mt-2" id="statusLine"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Add/Edit -->
<div class="modal fade" id="mdlIndicator" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content" id="frmIndicator" novalidate>
      <div class="modal-header">
        <h5 class="modal-title kh-head">ព័ត៌មានសូចនាករ</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="បិទ"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="indicator_id" />
        <div class="mb-3">
          <label class="form-label">ឈ្មោះសូចនាករ <span class="text-danger">*</span></label>
          <input id="indicator_name" class="form-control" required />
          <div class="invalid-feedback">សូមបញ្ចូលឈ្មោះសូចនាករ</div>
        </div>
        <div class="mb-3">
          <label class="form-label">ប្រភេទ</label>
          <input id="indicator_type" class="form-control" placeholder="ឧ. Output / Outcome / Process" />
        </div>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">ជំពូក</label>
            <select id="department_id" class="form-select"></select>
            <div class="form-text">មិនមែន SUPER ចាក់សោរ​ត្រឹមជំពូកខ្លួន</div>
          </div>
          <div class="col-md-6">
            <label class="form-label">ផ្នែក</label>
            <select id="unit_id" class="form-select"><option value="">— ជ្រើសផ្នែក —</option></select>
            <div class="form-text">មិនមែន SUPER ចាក់សោរ​ផ្នែកខ្លួន</div>
          </div>
        </div>
        <div class="mt-3">
          <label class="form-label">ម្ចាស់ (Owner)</label>
          <select id="owner_id" class="form-select"><option value="">— ជ្រើសម្ចាស់ —</option></select>
          <div class="form-text">SUPER អាច delegate សូចនាករ អោយអ្នកប្រើណាមួយ</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">បោះបង់</button>
        <button class="btn btn-primary" type="submit" id="btnSave">រក្សាទុក</button>
      </div>
    </form>
  </div>
</div>

<style>
  .settings-page{flex:1 1 auto; display:flex; flex-direction:column; min-height:0;}
  .container-page{width:100%; max-width:1280px; margin:0 auto; padding:16px 18px 12px;}
  .page-head{display:flex; flex-direction:column; gap:10px; margin-bottom:12px;}
  .centered-card{max-width:1200px; border:1px solid #eef0f4; border-radius:14px;}
  .table thead th{ white-space:nowrap; }
  .skel{ position:relative; overflow:hidden; background:#f3f4f6; height:44px; }
  .skel::after{ content:""; position:absolute; inset:0; transform:translateX(-100%);
    background:linear-gradient(90deg,transparent,rgba(255,255,255,.7),transparent); animation:shimmer 1.1s infinite }
  @keyframes shimmer{ 100%{ transform:translateX(100%);} }
  .toolbar{display:flex; align-items:center; gap:12px; flex-wrap:wrap;}
  .toolbar .actions{min-width:260px;}
  @media (max-width: 576px){
    .toolbar .actions{min-width:0; width:100%;}
    .toolbar .input-group{width:100%;}
  }
  /* ✅ Sort affordance */
  #tblIndicators thead th[data-sort]{ cursor:pointer; user-select:none; }
  #tblIndicators thead th[data-sort]:hover{ text-decoration:underline; }
</style>

<!-- Link JS (ES module).
     ប្រសិនបើអ្នកមាន router/hydrator ផ្សេង សូមដាក់ import/call នៅទីនោះជំនួស -->
<script type="module">
  import hydrate from '/assets/js/pages/indicators.page.js';
  // បើអ្នកប្រើ router ផ្សេងទៀត សូមយកបន្ទាត់ខាងក្រោមចេញ ហើយឲ្យ router ហៅ hydrate(root) ផ្ទាល់
  hydrate(document);
</script>
