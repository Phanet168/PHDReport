<!-- Dashboard page (fills all space above footer) -->
<div class="dashboard-page">
  <div class="container-page">
    <h4 class="kh-head mb-2">ផ្ទាំងសង្ខេប</h4>
    <div class="separator-breadcrumb border-top mb-2"></div>
</div>
<span class="small text-muted" style="margin:0 auto 8px auto;">(Powered by <a href="https://phanet168.github.io/PHDReport" target="_blank" rel="noopener">PHD Report</a>)</span>
  <div class="container-page" style="flex:1 1 auto;display:flex;flex-direction:column;min-height:0;">
    <!-- KPI cards -->
    <div class="row g-3 g-kpi">
      <div class="col-md-3"><div class="card kpi p-3 text-center"><h6 class="text-muted mb-1">សូចនាករ</h6><div id="kpiIndicators" class="display-6">–</div></div></div>
      <div class="col-md-3"><div class="card kpi p-3 text-center"><h6 class="text-muted mb-1">ការិយាល័យ</h6><div id="kpiDepts" class="display-6">–</div></div></div>
      <div class="col-md-3"><div class="card kpi p-3 text-center"><h6 class="text-muted mb-1">ផ្នែក</h6><div id="kpiUnits" class="display-6">–</div></div></div>
      <div class="col-md-3"><div class="card kpi p-3 text-center"><h6 class="text-muted mb-1">របាយការណ៍</h6><div id="kpiReports" class="display-6">–</div></div></div>
    </div>

    <!-- Charts (stretch to footer) -->
    <div class="charts-row mt-2">
      <div class="card chart-card">
        <h6 class="mb-2 text-muted">របាយការណ៍តាមខែ</h6>
        <div id="chartMonthly" class="chart-box"></div>
      </div>
      <div class="card chart-card">
        <h6 class="mb-2 text-muted">តាមការិយាល័យ</h6>
        <div id="chartDept" class="chart-box"></div>
      </div>
    </div>
  </div>
</div>

<style>
  /* chain flex so page eats all space above footer */
  .dashboard-page{flex:1 1 auto;display:flex;flex-direction:column;min-height:0;}
  .container-page{flex:1 1 auto;display:flex;flex-direction:column;min-height:0; /* <<< critical */ 
    width:100%;max-width:1280px;margin:0 auto;padding:12px 16px 8px;}
  .g-kpi .card.kpi{border:1px solid #eef0f4;border-radius:14px;box-shadow:0 10px 22px rgba(0,0,0,.05)}
  .g-kpi .display-6{line-height:1}

  .charts-row{flex:1 1 auto;min-height:0;display:grid;gap:14px;grid-template-columns:1.25fr 1fr;align-items:stretch;}
  .chart-card{padding:12px;display:flex;flex-direction:column;min-height:0;border:1px solid #eef0f4;border-radius:14px;box-shadow:0 10px 22px rgba(0,0,0,.05);background:#fff;}
  .chart-box{flex:1 1 auto;min-height:420px;}  /* fills the remaining vertical space */
  @media (max-width: 992px){.charts-row{grid-template-columns:1fr}.chart-box{min-height:340px}}
</style>

<script>
  // auto-resize charts on container resize
  (function(){
    if(!window.ResizeObserver || !window.echarts) return;
    const ec=window.echarts, ids=['chartMonthly','chartDept'];
    const els=ids.map(id=>document.getElementById(id)).filter(Boolean);
    const ro=new ResizeObserver(()=>els.forEach(el=>{const i=ec.getInstanceByDom(el); if(i) i.resize();}));
    els.forEach(el=>ro.observe(el));
  })();
</script>
